'-----------------------------------------------------------------'
' 			ECON 513 CAPSTONE - KING COUNTY REAL ESTATE
' 
'Home Directory: CD C:\Users\klatt\OneDrive\Documents\MSQE\Metrics_IV\Capstone_RE
'FILE NAME: RUN CAPSTONE_C2.PRG
'---------------------------------------------------------------------------'

'--------------------------------------
'------------WEEKLY SECTION-----------
'--------------------------------------

'--CREATE WEEKLY WORKFILE
WORKFILE CAP_WEEKLY W 4/1/1971 6/1/2023

  'PAGERENAME UNTITLED ANNUAL_INPUT

'--READ IN WEEKLY EXCEL
READ(B8, S=Weekly) Capstone_Excel_King_Co_RE.xls MRTGRT
'SHOW MRTGRT


'--Create Eviews Database
IF @FILEEXIST("DB_CAPSTONE.edb")=1 THEN
		DBDELETE DB_CAPSTONE
	ENDIF
	DBCREATE DB_CAPSTONE.EDB

'--STORE WEEKLY DATA IN DATABASE	
STORE(D=DB_CAPSTONE) MRTGRT

CLOSE CAP_WEEKLY

'--------------------------------------
'------------ANNUAL SECTION-----------
'--------------------------------------

'--CREATE ANNUAL WORKFILE
WORKFILE CAP_ANNUAL A 1950 2025

'--READ IN ANNUAL EXCEL
READ(B8, S=Annual) Capstone_Excel_King_Co_RE.xls EDUC_BACH_PCT	EDUC_GRAD	POP25	PROP_TAX	MEANHHINC_WEST	NPRIME$	INCPERCAP	HSTOCKACS NPRIME_MRTG_ORIG	ALL_MRTG_ORIG	NPRIME_SHARE

'SHOW EDUC_BACH_PCT	EDUC_GRAD	POP25	PROP_TAX	MEANHHINC_WEST	NPRIME	INCPERCAP	HSTOCKACS

'-----------------------------------------'
' 		ANNUAL DATA DERIVATIONS
'-----------------------------------------'
'PLACEHOLDER


'-----------------------------------------'
' 		ANNUAL INERTIAL MODELS
'-----------------------------------------'
'NEED TO FORECAST BACK AND FORWARD EDUC_BACH_PCT

'--[EDUC_BACH_PCT] STEP 1 PRE-WHITENING--'
SMPL 2006 2019
GROUP CHART_EDUC_BACH_PCT
CHART_EDUC_BACH_PCT.ADD EDUC_BACH_PCT
'CHART_EDUC_BACH_PCT.LINE

SERIES D_2_EDUC_BACH_PCT = D(EDUC_BACH_PCT, 2)
'SHOW D_2_EDUC_BACH_PCT

GROUP CHART_D_2_EDUC_BACH_PCT
CHART_D_2_EDUC_BACH_PCT.ADD D_2_EDUC_BACH_PCT
'CHART_D_2_EDUC_BACH_PCT.LINE

'--[EDUC_BACH_PCT] STEP 2 INDENTIFICATION----'
D_2_EDUC_BACH_PCT.IDENT(12)

'--[EDUC_BACH_PCT] STEP 3 ESTIMATION----'
EQUATION MOD_EDUC_BACH_PCT.LS D(EDUC_BACH_PCT, 2) AR(1) MA(1)
'MOD_EDUC_BACH_PCT.STATS
SERIES RESIDS_MOD_EDUC_BACH_PCT = RESID

'--[EDUC_BACH_PCT] STEP 4 DIAGNOSTICS----'

'RESIDS_MOD_EDUC_BACH_PCT.IDENT(24)

'--[EDUC_BACH_PCT] STEP 5 FORECAST--'
'FILL IN 2020
SMPL 2020 2020
MOD_EDUC_BACH_PCT.FORECAST FOR_EDUC_BACH_PCT
'REVERT TO STANDARD MNEMONICS
SERIES EDUC_BACH_PCT = FOR_EDUC_BACH_PCT
'FILL IN 2022-2023
SMPL 2022 2023
MOD_EDUC_BACH_PCT.FORECAST FOR_EDUC_BACH_PCT
'REVERT TO STANDARD MNEMONICS
SERIES EDUC_BACH_PCT = FOR_EDUC_BACH_PCT

SMPL 1998 2025

'SHOW FOR_EDUC_BACH_PCT EDUC_BACH_PCT

'NEED TO FORACEST INCOME PER CAPITA

'--[INCPERCAP] STEP 1 PRE-WHITENING--'
SMPL 1969 2021
GROUP CHART_INCPERCAP
CHART_INCPERCAP.ADD INCPERCAP
CHART_INCPERCAP.LINE

SERIES D2_INCPERCAP = D(LOG(INCPERCAP), 2)
SHOW D2_INCPERCAP

GROUP CHART_D2_INCPERCAP
CHART_D2_INCPERCAP.ADD D2_INCPERCAP
CHART_D2_INCPERCAP.LINE


'--[INCPERCAP] STEP 2 INDENTIFICATION----'
D2_INCPERCAP.IDENT(12)

'--[INCPERCAP] STEP 3 ESTIMATION----'
EQUATION MOD_INCPERCAP.LS D(LOG(INCPERCAP), 2) AR(1) AR(4) MA(1)
MOD_INCPERCAP.STATS
SERIES RESIDS_MOD_INCPERCAP = RESID

'--[INCPERCAP] STEP 4 DIAGNOSTICS----'

RESIDS_MOD_INCPERCAP.IDENT(24)

'--[INCPERCAP] STEP 5 FORECAST--'
'FILL IN 2022-2023
SMPL 2022 2023
MOD_INCPERCAP.FORECAST FOR_INCPERCAP


'REVERT TO STANDARD MNEMONICS
SERIES INCPERCAP = FOR_INCPERCAP

SMPL 1998 2025

SHOW FOR_INCPERCAP INCPERCAP



'--STORE ANNUAL DATA IN DATABASE	
STORE(D=DB_CAPSTONE) EDUC_BACH_PCT	EDUC_GRAD	POP25	PROP_TAX	MEANHHINC_WEST	INCPERCAP	HSTOCKACS	NPRIME_SHARE

'SHOW EDUC_BACH_PCT	EDUC_GRAD	POP25	PROP_TAX	MEANHHINC_WEST	NPRIME	INCPERCAP	HSTOCKA

CLOSE CAP_ANNUAL

'--------------------------------------
'------------QUARTERLY SECTION-----------
'--------------------------------------

'--CREATE QUARTERLY WORKFILE
WORKFILE CAP_QUARTERLY Q 1945:1 2030:1

  'PAGERENAME UNTITLED Q_CONVERTED
  
FETCH(D=DB_CAPSTONE, C=CUBICL)  HSTOCKACS
SHOW HSTOCKACS


'--READ IN QUARTERLY EXCEL
READ(C8, S=Quarterly) Capstone_Excel_King_Co_RE.xls MEDHHINC	MEDFAMINC	POP04	POP59	POP1014	POP1519	POP2024	POP2529	POP3034	POP3539	POP4044	POP4549	POP5054	POP5559	POP6064	POP6569	POP	HSTOCKQ	WKLYWAGE	W$	PrimeHBAgeCnt	PrimeHBAgePct HSTOCKOVERPRIMPOP

SHOW MEDHHINC	MEDFAMINC	POP04	POP59	POP1014	POP1519	POP2024	POP2529	POP3034	POP3539	POP4044	POP4549	POP5054	POP5559	POP6064	POP6569	POP	HSTOCKQ	WKLYWAGE	W$	PrimeHBAgeCnt	PrimeHBAgePct	HSTOCKOVERPRIMPOP


'-----------------------------------------'
' 		QUARTERLY DATA DERIVATIONS
'-----------------------------------------'



'-----------------------------------------'
' 		QUARTERLY INERTIAL MODELS
'-----------------------------------------'

'----------------
'   [HSTOCKQ] ARIMA
'----------------

'--[HSTOCKQ] STEP 1 PRE-WHITENING--'
SMPL 1970Q1 2010Q2
GROUP CHART_HSTOCKQ
CHART_HSTOCKQ.ADD HSTOCKQ
'CHART_HSTOCKQ.LINE

SERIES D_PCY_HSTOCKQ = D(@PCY(HSTOCKQ))
'SHOW PCY_HSTOCKQ

GROUP CHART_D_PCY_HSTOCKQ
CHART_D_PCY_HSTOCKQ.ADD D_PCY_HSTOCKQ
'CHART_D_PCY_HSTOCKQ.LINE

'--[HSTOCKQ] STEP 2 INDENTIFICATION----'
'D_PCY_HSTOCKQ.IDENT(36)

'--[HSTOCKQ] STEP 3 ESTIMATION----'
EQUATION MOD_HSTOCKQ.LS D(@PCY(HSTOCKQ)) AR(1) AR(2) AR(3) AR(4) AR(5) MA(2)
'MOD_HSTOCKQ.STATS
SERIES RESIDS_MOD_HSTOCKQ = RESID

'--[HSTOCKQ] STEP 4 DIAGNOSTICS----'
'RESIDS_MOD_HSTOCKQ.IDENT(24)


'--[HSTOCKQ] STEP 5 FORECAST--'
SMPL 2010Q2 2024Q4
MOD_HSTOCKQ.FORECAST FOR_HSTOCKQ
'SHOW FOR_HSTOCKQ HSTOCKACS

GROUP HSTOCK
HSTOCK.ADD FOR_HSTOCKQ HSTOCKACS
'HSTOCK.LINE 

'--[HSTOCKQ] REVERT TO STANDARD MNEMONICS
SERIES HSTOCKQ = FOR_HSTOCKQ
SMPL @ALL


'PLACEHOLDER


'--STORE QUARTERLY DATA IN DATABASE	
STORE(D=DB_CAPSTONE) MEDHHINC	MEDFAMINC	POP04	POP59	POP1014	POP1519	POP2024	POP2529	POP3034	POP3539	POP4044	POP4549	POP5054	POP5559	POP6064	POP6569	POP	HSTOCKQ	WKLYWAGE	W$	PrimeHBAgeCnt	PrimeHBAgePct	HSTOCKOVERPRIMPOP


'-----------------------------------------'
' 		QUARTERLY EDA
'-----------------------------------------'
'--what are growth comparisons for ACS versus BOC in the overlap?
SMPL 2009:1 2010:2
'SHOW @PCY(HSTOCKQ) HSTOCKQ @PCY(HSTOCKACS) HSTOCKACS


CLOSE CAP_QUARTERLY

'--------------------------------------
'------------MONTHLY SECTION-----------
'--------------------------------------

'--Create Monthly Workfile
WORKFILE CAP_MONTHLY M 1970:1 2025:12

  'PAGERENAME UNTITLED M_CONVERTED

'--Fetch from database
'--Those that need to be averaged
FETCH(D=DB_CAPSTONE, C=A) WKLYWAGE MRTGRT  

'--Those that need to be the last value
FETCH(D=DB_CAPSTONE, C=CUBICL) HSTOCKQ HSTOCKACS INCPERCAP PrimeHBAgeCnt	PrimeHBAgePct EDUC_BACH_PCT NPRIME_SHARE W$
'SHOW HSTOCKQ HSTOCKACS


'--Read from Monthly Excel
READ(B8, S=Monthly) Capstone_Excel_King_Co_RE.xls KING_PAVE	KING_PMED	KING_ATM	KING_NEWLIST	KING_ACTLIST	AMZN	MSFT	BA	XCPIU	XCPIUAH	CPIU	SEA_XCPIU	SEA_XCPIUAH	SEA_CPIU	XHCSHP1TIM	STARTS	ZSTARTS	COMP	XCOMP	PERMITS	JOBS_NF	JOBS	LOCALEQUITYWEALTH

'SHOW KING_PAVE	KING_PMED	KING_ATM	KING_NEWLIST	KING_ACTLIST	AMZN	MSFT	BA	XCPIU	XCPIUAH	CPIU	SEA_XCPIU	SEA_XCPIUAH	SEA_CPIU	XHCSHP1TIM	STARTS	ZSTARTS	COMP	XCOMP	PERMITS	JOBS_NF	JOBS	LOCALEQUITYWEALTH

'---------------------------------------------'
' 				CHARTS
'----------------------------------------------'

SMPL 1997:8 2023:4
GROUP MED_CHART_LEVELS
MED_CHART_LEVELS.ADD KING_PMED
'MED_CHART_LEVELS.LINE

GROUP MED_CHART_LOG
MED_CHART_LOG.ADD LOG(KING_PMED)
'MED_CHART_LOG.LINE

GROUP MED_CHART_PCY
MED_CHART_PCY.ADD @PCY(KING_PMED)
'MED_CHART_PCY.LINE

GROUP MED_CHART_2D
MED_CHART_2D.ADD D(KING_PMED, 2, 12)
'MED_CHART_2D.LINE

GROUP MED_CHART_LOG_2D
MED_CHART_LOG_2D.ADD D(LOG(KING_PMED), 2, 12)
'MED_CHART_LOG_2D.LINE

GROUP LIST_CHART_LEVELS
LIST_CHART_LEVELS.ADD KING_ACTLIST
'LIST_CHART_LEVELS.LINE

GROUP LIST_CHART_PCY
LIST_CHART_PCY.ADD @PCY(KING_ACTLIST)
'LIST_CHART_PCY.LINE

'--WRITE PCY DVS TO EXCEL TO COMPUTE SUMMARY STATS
GROUP EXPORT_SUMSTAT
EXPORT_SUMSTAT.ADD @PCY(KING_PMED) @PCY(KING_ACTLIST)
'WRITE(B2) DV_PCY_EXPORT.XLS EXPORT_SUMSTAT


'-----------------------------------------------------------------------------'
' 				CHOW-LIN INTERPOLATION
'---------------------------------------------------------------------------'

'COPY(C=CHOWLINL) QTRLY::Q_CONVERTED\HSTOCKQ MONTHLY::M_CONVERTED\HSTOCKQ @INDICATOR HSTOCKACS
'SHOW HSTOCKQ


'-----------------------------------------'
' 		MONTHLY INERTIAL MODELS
'		IN SUPPORT OF STRUCTURAL
'-----------------------------------------'


'----------------------
'   [KING_PMED] ARIMA
'----------------------
'ARIMAs FOR MEDIAN AND LISTINGS
'NEED TO FILL IN THE ONE MISSING DATA FOR MEDIAN HOM PRICE AND LISTS

SMPL 1997:8 2023:4
'--MEDIAN HOME PRICE
'--[KING_PMED] STEP 2 INDENTIFICATION----'
'PCY_KING_PMED.IDENT(24)

'--[KING_PMED] STEP 3 ESTIMATION----'
EQUATION MOD_KING_PMED.LS @PCY(KING_PMED) C AR(1) MA(1) SMA(12)
'MOD_KING_PMED.STATS
SERIES RESIDS_MOD_KING_PMED = RESID

'--[KING_PMED] STEP 4 DIAGNOSTICS----'
'RESIDS_MOD_KING_PMED.IDENT(24)

'--[KING_PMED] STEP 5 FORECAST--'
SMPL 2000:1 2000:1
MOD_KING_PMED.FORECAST FOR_KING_PMED
'SHOW FOR_KING_PMED

'--[KING_PMED] REVERT TO STANDARD MNEMONICS
SMPL 2000:1 2000:1
SERIES KING_PMED = FOR_KING_PMED
SMPL 1997:8 2023:4
'SHOW KING_PMED

'----------------------
'   [KING_PAVE] ARIMA
'----------------------

SMPL 1997:8 2023:4
SERIES PCY_KING_PAVE = @PCY(KING_PAVE)
PCY_KING_PAVE.LINE

'--[KING_PAVE] STEP 2 INDENTIFICATION----'
PCY_KING_PAVE.IDENT(24)

'--[KING_PAVE] STEP 3 ESTIMATION----'
EQUATION MOD_KING_PAVE.LS @pcy(king_pave) ar(1) ma(1) sma(12)  ar(12)
MOD_KING_PAVE.STATS

SERIES RESIDS_MOD_KING_PAVE = RESID

'--[KING_PAVE] STEP 4 DIAGNOSTICS----'
'RESIDS_MOD_KING_PAVE.IDENT(24)

'--[KING_PAVE] STEP 5 FORECAST--'
SMPL 2023:5 2024:12
MOD_KING_PAVE.FORECAST FOR_KING_PAVE
'SHOW FOR_KING_PAVE

'--[KING_PAVE] REVERT TO STANDARD MNEMONICS
SMPL 2023:5 2024:12
SERIES KING_PAVE = FOR_KING_PAVE
SMPL 1997:8 2023:4
'SHOW KING_PAVE


'----------------------
'   [KING_ACLIST] ARIMA
'----------------------
SMPL 1997:8 2023:4
'--ACTIVE LISTINGS

'--[KING_ACTLIST] STEP 2 INDENTIFICATION----'
'PCY_KING_ACTLIST.IDENT(12)

'--[KING_ACTLIST] STEP 3 ESTIMATION----'
EQUATION MOD_KING_ACTLIST.LS D(KING_ACTLIST, 2, 12) AR(1) AR(2) SAR(12) MA(1) SMA(12)
'MOD_KING_ACTLIST.STATS
SERIES RESIDS_MOD_KING_ACTLIST = RESID

'--[KING_ACTLIST] STEP 4 DIAGNOSTICS----'
'RESIDS_MOD_KING_ACTLIST.IDENT(24)

'--[KING_ACTLIST] STEP 5 FORECAST--'
SMPL 2000:1 2000:1
MOD_KING_ACTLIST.FORECAST FOR_KING_ACTLIST


'--[KING_ACTLIST] REVERT TO STANDARD MNEMONICS
SMPL 2000:1 2000:1
SERIES KING_ACTLIST = FOR_KING_ACTLIST

SMPL 1997:8 2023:4
'SHOW KING_ACTLIST



'----------------------
'   [KING_ATM] ARIMA
'----------------------
'--[KING_ATM] STEP 1 PRE-WHITENING--'
SMPL 1997:8 2023:4
GROUP CHART_KING_ATM
CHART_KING_ATM.ADD KING_ATM
'CHART_KING_ATM.LINE

SERIES PCY_KING_ATM = D(KING_ATM, 2, 12)
'SHOW PCY_KING_ATM

GROUP CHART_PCY_KING_ATM
CHART_PCY_KING_ATM.ADD PCY_KING_ATM
'CHART_PCY_KING_ATM.LINE


'--[KING_ATM] STEP 2 INDENTIFICATION----'
'PCY_KING_ATM.IDENT(24)

'--[KING_ATM] STEP 3 ESTIMATION----'
EQUATION MOD_KING_ATM.LS d(king_atm, 2, 12) ar(1) ma(1) sma(12) sar(12)
'MOD_KING_ATM.STATS
SERIES RESIDS_MOD_KING_ATM = RESID

'--[KING_ACTLIST] STEP 5 FORECAST--'
SMPL 2023:5 2024:12
MOD_KING_ATM.FORECAST FOR_KING_ATM
'SHOW FOR_KING_ATM


'--[KING_ACTLIST] REVERT TO STANDARD MNEMONICS
SMPL 2023:5 2024:12
SERIES KING_ATM = FOR_KING_ATM

SMPL 1997:8 2023:4
'SHOW KING_ATM


'----------------------
'   [JOBS_NF] ARIMA
'----------------------

'--[JOBS_NF] STEP 1 PRE-WHITENING--'
'--ONLY MODELING ON PRE-COVID TIMES
SMPL 1997:8 2020:2
GROUP CHART_JOBS_NF
CHART_JOBS_NF.ADD JOBS_NF
CHART_JOBS_NF.LINE

SERIES PCY_JOBS_NF = D(LOG(JOBS_NF), 2)
SHOW PCY_JOBS_NF

GROUP CHART_PCY_JOBS_NF
CHART_PCY_JOBS_NF.ADD PCY_JOBS_NF
CHART_PCY_JOBS_NF.LINE


'--[JOBS_NF] STEP 2 INDENTIFICATION----'
PCY_JOBS_NF.IDENT(24)

'--[JOBS_NF] STEP 3 ESTIMATION----'
EQUATION MOD_JOBS_NF.LS d(LOG(jobs_nf), 2) ar(1) ma(1) ma(3) sma(12) sar(12)
MOD_JOBS_NF.STATS
SERIES RESIDS_MOD_JOBS_NF = RESID

'--[KING_ACTLIST] STEP 5 FORECAST--'
SMPL 2023:5 2024:12
MOD_JOBS_NF.FORECAST FOR_JOBS_NF
'SHOW FOR_JOBS_NF


'--[JOBS_NF] REVERT TO STANDARD MNEMONICS
SMPL 2023:5 2024:12
SERIES JOBS_NF = FOR_JOBS_NF

SMPL 1997:8 2023:4
'SHOW JOBS_NF


'----------------------
'   [MRTGRT] ARIMA
'----------------------
'--[MRTGRT] STEP 1 PRE-WHITENING--'
SMPL 1997:8 2023:4
GROUP CHART_MRTGRT
CHART_MRTGRT.ADD MRTGRT
CHART_MRTGRT.LINE

SERIES PCY_MRTGRT = D(MRTGRT, 2)
SHOW PCY_MRTGRT

GROUP CHART_PCY_MRTGRT
CHART_PCY_MRTGRT.ADD PCY_MRTGRT
CHART_PCY_MRTGRT.LINE


'--[MRTGRT] STEP 2 INDENTIFICATION----'
PCY_MRTGRT.IDENT(24)

'--[MRTGRT] STEP 3 ESTIMATION----'
EQUATION MOD_MRTGRT.LS d(mrtgrt, 2) ar(1) ar(2) ar(3) ma(4) ma(5)
MOD_MRTGRT.STATS
SERIES RESIDS_MOD_MRTGRT = RESID
RESIDS_MOD_MRTGRT.IDENT(24)

'--[MRTGRT] STEP 5 FORECAST--'
SMPL 2023:5 2024:12
MOD_MRTGRT.FORECAST FOR_MRTGRT
SHOW FOR_MRTGRT


'--[MRTGRT] REVERT TO STANDARD MNEMONICS
SMPL 2023:5 2024:12
SERIES MRTGRT = FOR_MRTGRT

SMPL 1997:8 2023:4
'SHOW MRTGRT

'----------------------
'   [XCPIU] ARIMA
'----------------------
'--[XCPIU] STEP 1 PRE-WHITENING--'
'--ONLY MODELING ON PRE-COVID TIMES
SMPL 1997:8 2020:2
GROUP CHART_XCPIU
CHART_XCPIU.ADD XCPIU
CHART_XCPIU.LINE

SERIES PCY_XCPIU = @PC(XCPIU)
SHOW PCY_XCPIU

GROUP CHART_PCY_XCPIU
CHART_PCY_XCPIU.ADD PCY_XCPIU
CHART_PCY_XCPIU.LINE


'--[XCPIU] STEP 2 INDENTIFICATION----'
PCY_XCPIU.IDENT(24)

'--[XCPIU] STEP 3 ESTIMATION----'
EQUATION MOD_XCPIU.LS @pc(xcpiu) ar(1) ma(1) sma(12) ma(11)
MOD_XCPIU.STATS
SERIES RESIDS_MOD_XCPIU = RESID

'--[XCPIU] STEP 5 FORECAST--'
SMPL 2023:5 2024:12
MOD_XCPIU.FORECAST FOR_XCPIU
SHOW FOR_XCPIU

'--[XCPIU] REVERT TO STANDARD MNEMONICS
SMPL 2023:5 2024:12
SERIES XCPIU = FOR_XCPIU

SMPL 1997:8 2023:4
'SHOW XCPIU


'----------------------
'   [SEA_XCPIUAH] ARIMA
'COME BACK HERE AFTER BUILDING MODEL OBJECT TO WORK ON ARIMAS
'----------------------
'--[SEA_XCPIUAH] STEP 1 PRE-WHITENING--'
'--ONLY MODELING ON PRE-COVID TIMES
SMPL 1997:8 2020:2
GROUP CHART_SEA_XCPIUAH
CHART_SEA_XCPIUAH.ADD SEA_XCPIUAH
'CHART_SEA_XCPIUAH.LINE

SERIES PCY_SEA_XCPIUAH = @PC(SEA_XCPIUAH)
'SHOW PCY_SEA_XCPIUAH

GROUP CHART_PCY_SEA_XCPIUAH
CHART_PCY_SEA_XCPIUAH.ADD PCY_SEA_XCPIUAH
'CHART_PCY_SEA_XCPIUAH.LINE


'--[SEA_XCPIUAH] STEP 2 INDENTIFICATION----'
'PCY_SEA_XCPIUAH.IDENT(24)

'--[SEA_XCPIUAH] STEP 3 ESTIMATION----'
EQUATION MOD_SEA_XCPIUAH.LS @pc(SEA_XCPIUAH) ar(1) ma(1) 
'MOD_SEA_XCPIUAH.STATS
SERIES RESIDS_MOD_SEA_XCPIUAH = RESID

'--[SEA_XCPIUAH] STEP 5 FORECAST--'
SMPL 2023:5 2024:12
MOD_SEA_XCPIUAH.FORECAST FOR_SEA_XCPIUAH
'SHOW FOR_SEA_XCPIUAH

'--[SEA_XCPIUAH] REVERT TO STANDARD MNEMONICS
SMPL 2023:5 2024:12
SERIES SEA_XCPIUAH = FOR_SEA_XCPIUAH

SMPL 1997:8 2023:4
'SHOW SEA_XCPIUAH

'----------------------
'   [SEA_XCPIU] ARIMA
'----------------------
'--[SEA_XCPIU] STEP 1 PRE-WHITENING--'
'--ONLY MODELING ON PRE-COVID TIMES
SMPL 1997:8 2020:2
GROUP CHART_SEA_XCPIU
CHART_SEA_XCPIU.ADD SEA_XCPIU
CHART_SEA_XCPIU.LINE

SERIES PCY_SEA_XCPIU = @PC(SEA_XCPIU)
SHOW PCY_SEA_XCPIU

GROUP CHART_PCY_SEA_XCPIU
CHART_PCY_SEA_XCPIU.ADD PCY_SEA_XCPIU
CHART_PCY_SEA_XCPIU.LINE


'--[SEA_XCPIU] STEP 2 INDENTIFICATION----'
PCY_SEA_XCPIU.IDENT(24)

'--[SEA_XCPIU] STEP 3 ESTIMATION----'
EQUATION MOD_SEA_XCPIU.LS @pc(SEA_XCPIU) ar(1) ma(1) 
MOD_SEA_XCPIU.STATS
SERIES RESIDS_MOD_SEA_XCPIU = RESID

'--[SEA_XCPIU] STEP 5 FORECAST--'
SMPL 2023:5 2024:12
MOD_SEA_XCPIU.FORECAST FOR_SEA_XCPIU
SHOW FOR_SEA_XCPIU

'--[SEA_XCPIU] REVERT TO STANDARD MNEMONICS
SMPL 2023:5 2024:12
SERIES SEA_XCPIU = FOR_SEA_XCPIU

SMPL 1997:8 2023:4
'SHOW SEA_XCPIU

'----------------------
'   [INCPERCAP] ARIMA
'----------------------
'--[INCPERCAP] STEP 1 PRE-WHITENING--'
'--ONLY MODELING ON PRE-COVID TIMES
SMPL 1997:8 2020:2
GROUP CHART_INCPERCAP
CHART_INCPERCAP.ADD INCPERCAP
'CHART_INCPERCAP.LINE

SERIES PCY_INCPERCAP = @PCA(INCPERCAP)
'SHOW PCY_INCPERCAP

GROUP CHART_PCY_INCPERCAP
CHART_PCY_INCPERCAP.ADD PCY_INCPERCAP
'CHART_PCY_INCPERCAP.LINE


'--[INCPERCAP] STEP 2 INDENTIFICATION----'
'PCY_INCPERCAP.IDENT(24)

'--[INCPERCAP] STEP 3 ESTIMATION----'
EQUATION MOD_INCPERCAP.LS @pc(INCPERCAP) ar(1) ma(1) 
MOD_INCPERCAP.STATS
SERIES RESIDS_MOD_INCPERCAP = RESID

'--[INCPERCAP] STEP 5 FORECAST--'
SMPL 2023:5 2024:12
MOD_INCPERCAP.FORECAST FOR_INCPERCAP
'SHOW FOR_INCPERCAP

'--[INCPERCAP] REVERT TO STANDARD MNEMONICS
SMPL 2023:5 2024:12
SERIES INCPERCAP = FOR_INCPERCAP

SMPL 1997:8 2023:4
'SHOW INCPERCAP

'----------------------
'   [PERMITS] ARIMA
'----------------------

'--[PERMITS] STEP 1 PRE-WHITENING--'
'--ONLY MODELING ON PRE-COVID TIMES
SMPL 1997:8 2020:2
GROUP CHART_PERMITS
CHART_PERMITS.ADD PERMITS
'CHART_PERMITS.LINE

SERIES PCY_PERMITS = @PCA(PERMITS)
'SHOW PCY_PERMITS

GROUP CHART_PCY_PERMITS
CHART_PCY_PERMITS.ADD PCY_PERMITS
'CHART_PCY_PERMITS.LINE


'--[PERMITS] STEP 2 INDENTIFICATION----'
'PCY_PERMITS.IDENT(24)

'--[PERMITS] STEP 3 ESTIMATION----'
EQUATION MOD_PERMITS.LS @pcA(PERMITS) ar(1) ma(1) 
MOD_PERMITS.STATS
SERIES RESIDS_MOD_PERMITS = RESID

'--[PERMITS] STEP 5 FORECAST--'
SMPL 2023:5 2024:12
MOD_PERMITS.FORECAST FOR_PERMITS
'SHOW FOR_PERMITS

'--[PERMITS] REVERT TO STANDARD MNEMONICS
SMPL 2023:5 2024:12
SERIES PERMITS = FOR_PERMITS

SMPL 1997:8 2023:4
'SHOW PERMITS

'----------------------
'   [LOCALEQUITYWEALTH] ARIMA
'----------------------
'--[LOCALEQUITYWEALTH] STEP 1 PRE-WHITENING--'
'--ONLY MODELING ON PRE-COVID TIMES
SMPL 1997:8 2020:2
GROUP CHART_LOCALEQUITYWEALTH
CHART_LOCALEQUITYWEALTH.ADD LOCALEQUITYWEALTH
'CHART_LOCALEQUITYWEALTH.LINE

SERIES PCY_LOCALEQUITYWEALTH = @PCA(LOCALEQUITYWEALTH)
'SHOW PCY_LOCALEQUITYWEALTH

GROUP CHART_PCY_LOCALEQUITYWEALTH
CHART_PCY_LOCALEQUITYWEALTH.ADD PCY_LOCALEQUITYWEALTH
'CHART_PCY_LOCALEQUITYWEALTH.LINE


'--[LOCALEQUITYWEALTH] STEP 2 INDENTIFICATION----'
'PCY_LOCALEQUITYWEALTH.IDENT(24)

'--[LOCALEQUITYWEALTH] STEP 3 ESTIMATION----'
EQUATION MOD_LOCALEQUITYWEALTH.LS @pc(LOCALEQUITYWEALTH) ar(1) ma(1) 
MOD_LOCALEQUITYWEALTH.STATS
SERIES RESIDS_MOD_LOCALEQUITYWEALTH = RESID

'--[LOCALEQUITYWEALTH] STEP 5 FORECAST--'
SMPL 2023:5 2024:12
MOD_LOCALEQUITYWEALTH.FORECAST FOR_LOCALEQUITYWEALTH
'SHOW FOR_LOCALEQUITYWEALTH

'--[LOCALEQUITYWEALTH] REVERT TO STANDARD MNEMONICS
SMPL 2023:5 2024:12
SERIES LOCALEQUITYWEALTH = FOR_LOCALEQUITYWEALTH

SMPL 1997:8 2023:4
'SHOW LOCALEQUITYWEALTH


'--CHECK TO SEE IF WE HAVE ALL THE FORECASTED DATA THAT WE NEED
SMPL 2021:10 2024:12
SHOW KING_ACTLIST KING_ATM JOBS_NF MRTGRT INCPERCAP PERMITS LOCALEQUITYWEALTH hstockq NPRIME_SHARE KING_PAVE

'-----------------------------------------------------------------------------'
' 				MONTHLY DATA DERIVATIONS
'---------------------------------------------------------------------------'
'--Make PCY FOR DVS FOR IDENTS. DON'T USE IN PLACE OF EMBEDDED TRANFORMATIONS

SERIES PCY_KING_PMED = @PCY(KING_PMED)
SERIES PCY_KING_ACTLIST = @PCY(KING_ACTLIST)

'--Make 1ST DIFF OF PCY OF DVS FOR IDENTS. DON'T USE IN PLACE OF EMBEDDED TRANFORMATIONS
SERIES D_PCY_KING_PMED = D(@PCY(KING_PMED))
SERIES D_PCY_KING_ACTLIST = D(@PCY(KING_ACTLIST))

SERIES D2_KING_PMED = D(KING_PMED, 2, 12) '--SECOND DIFFERENCE
'SERIES LOG_D2_KING_PMED = D(LOG(KING_PMED), 2, 12) '--LOG OF 2ND DIFFERENCE

'--CREATE POSTCOVID STEP VARIABLES 
SMPL @ALL
SERIES POSTCOVID_1YR = 0
SMPL 2021:04 2022:03
POSTCOVID_1YR = 1
SMPL @ALL

SMPL @ALL
SERIES POSTCOVID_2YR = 0
SMPL 2022:04 2023:03
POSTCOVID_2YR = 1
SMPL @ALL

SMPL @ALL
SERIES OMICRON = 0
SMPL 2022:04 2023:03
POSTCOVID_2YR = 1
SMPL @ALL

'--CREATE COVID STEP VARIABLES
SMPL @ALL
SERIES COVID = 0
SMPL 2020:04 2021:03
COVID = 1
SMPL @ALL

'--CREATE GREAT RECESSION STEP VARIABLE
SMPL @ALL
SERIES GREATRECESSION = 0
SMPL 2010:06 2012:01
GREATRECESSION = 1
SMPL @ALL

'--CREATE COVID STEP VARIABLES
SMPL @ALL
SERIES COVID = 0
SMPL 2020:04 2021:03
COVID = 1
SMPL @ALL

'--CREATE REAL ESTATE WEALTH 

SMPL 1997:08 2024:12
'--REBASE THE CPI TO 100 IN 2023 Q4

SERIES C_SEA_XCPIUAH = (SEA_XCPIUAH/@ELEM(SEA_XCPIUAH, "2023:4"))*100
SERIES C_SEA_XCPIU = (SEA_XCPIU/@ELEM(SEA_XCPIU, "2023:4"))*100
'SHOW C_SEA_XCPIUAH

'--Do i have all the variables I need for a structural model?
SHOW KING_PMED KING_ACTLIST INCPERCAP MRTGRT JOBS_NF PrimeHBAgeCnt	PrimeHBAgePct EDUC_BACH_PCT LOCALEQUITYWEALTH HSTOCKQ KING_PAVE NPRIME_SHARE


'--MAKE MEDIAN AND AVEREAGE HOME PRICE AND INCOME PER CAPITA REAL

SERIES KING_PMED$ = (KING_PMED/C_SEA_XCPIUAH)*100
SERIES KING_PAVE$ = (KING_PAVE/C_SEA_XCPIUAH)*100
SERIES INCPERCAP$ = (INCPERCAP/C_SEA_XCPIU)*100
SHOW KING_PMED$ KING_PAVE$ INCPERCAP$

'--MAKE INTEREST RATES REAL
SERIES MRTGRT$ = MRTGRT - @PCY(XCPIU)
SHOW MRTGRT$ MRTGRT (XCPIU-XCPIU(-4))/XCPIU(-4) @PCY(XCPIU)

'--CREATE INVENTORYDAYS VARIABLE
SERIES INVENTORYDAYS = KING_ACTLIST*KING_ATM


'-----------------------------------------------------------------------------'
' 				SUBJECTIVE FORECAST
'---------------------------------------------------------------------------'
SMPL 2023:05 2024:12
SERIES KING_PMED_SUBJ_F = KING_PMED
SERIES KING_ACTLIST_SUBJ_F = KING_ACTLIST

SMPL 2021:1 2024:12
GROUP CHART_SUBJ_F_PMED KING_PMED KING_PMED_SUBJ_F
CHART_SUBJ_F_PMED.ADD  KING_PMED KING_PMED_SUBJ_F
'CHART_SUBJ_F_PMED.LINE

SMPL 2021:1 2024:12
GROUP CHART_SUBJ_F_ACTLIST KING_ACTLIST KING_ACTLIST_SUBJ_F
CHART_SUBJ_F_ACTLIST.ADD  KING_ACTLIST KING_ACTLIST_SUBJ_F
'CHART_SUBJ_F_ACTLIST.LINE

 
'-----------------------------------------------------------------------------'
' 				STATIONARITY AND UNIT ROOT TESTS
'---------------------------------------------------------------------------'
SMPL 1997:8 2023:4
'--MEDIAN HOME PRICE: KING_PMED--'
'--LEVELS

'KING_PMED.IDENT(24)

FREEZE(KING_PMED_ADF) KING_PMED.UROOT(ADF,C,LAGMETHOD=AIC, MAXLAG=18)
'SHOW KING_PMED_ADF

FREEZE(KING_PMED_DFGLS) KING_PMED.UROOT(DFGLS,C,DIF=0,LAGMETHOD=AIC, MAXLAG=18)
'SHOW KING_PMED_DFGLS

FREEZE(KING_PMED_KPSS) KING_PMED.UROOT(KPSS,C,HAC=QS,BAND=5)
'SHOW KING_PMED_KPSS

'--PCY Growth

'PCY_KING_PMED.IDENT(24)

FREEZE(PCY_KING_PMED_ADF) @PCY(KING_PMED).UROOT(ADF,C,LAGMETHOD=AIC, MAXLAG=18)
'SHOW PCY_KING_PMED_ADF

FREEZE(PCY_KING_PMED_DFGLS) @PCY(KING_PMED).UROOT(DFGLS,C,DIF=0,LAGMETHOD=AIC, MAXLAG=18)
'SHOW PCY_KING_PMED_DFGLS

FREEZE(PCY_KING_PMED_KPSS) @PCY(KING_PMED).UROOT(KPSS,C,HAC=QS,BAND=5)
'SHOW PCY_KING_PMED_KPSS

'--Second Diff Growth

'D2_KING_PMED.IDENT(24)


FREEZE(D2_KING_PMED_ADF) D(KING_PMED, 2, 12).UROOT(ADF,C,LAGMETHOD=AIC, MAXLAG=18)
'SHOW D2_KING_PMED_ADF

FREEZE(D2_KING_PMED_DFGLS) D(KING_PMED, 2, 12).UROOT(DFGLS,C,DIF=0,LAGMETHOD=AIC, MAXLAG=18)
'SHOW D2_KING_PMED_DFGLS

FREEZE(D2_KING_PMED_KPSS) D(KING_PMED, 2, 12).UROOT(KPSS,C,HAC=QS,BAND=5)
'SHOW D2_KING_PMED_KPSS

'--lOG Second Diff Growth

'LOG_D2_KING_PMED.IDENT(24)


FREEZE(LOG_D2_KING_PMED_ADF) D(LOG(KING_PMED), 2, 12).UROOT(ADF,C,LAGMETHOD=AIC, MAXLAG=18)
'SHOW LOG_D2_KING_PMED_ADF

FREEZE(LOG_D2_KING_PMED_DFGLS) D(LOG(KING_PMED), 2, 12).UROOT(DFGLS,C,DIF=0,LAGMETHOD=AIC, MAXLAG=18)
'SHOW LOG_D2_KING_PMED_DFGLS

FREEZE(LOG_D2_KING_PMED_KPSS) D(LOG(KING_PMED), 2, 12).UROOT(KPSS,C,HAC=QS,BAND=5)
'SHOW LOG_D2_KING_PMED_KPSS


'--NUMBER OF ACTIVE LISTINGS: KING_ACTLIST--'
'--LEVELS

'KING_ACTLIST.IDENT(24)

FREEZE(KING_ACTLIST_ADF) KING_ACTLIST.UROOT(ADF,C,LAGMETHOD=AIC, MAXLAG=18)
'SHOW KING_ACTLIST_ADF

FREEZE(KING_ACTLIST_DFGLS) KING_ACTLIST.UROOT(DFGLS,C,DIF=0,LAGMETHOD=AIC, MAXLAG=18)
'SHOW KING_ACTLIST_DFGLS

FREEZE(KING_ACTLIST_KPSS) KING_ACTLIST.UROOT(KPSS,C,HAC=QS,BAND=5)
'SHOW KING_ACTLIST_KPSS

'--PCY Growth

'PCY_KING_ACTLIST.IDENT(24)

FREEZE(PCY_KING_ACTLIST_ADF) @PCY(KING_ACTLIST).UROOT(ADF,C,LAGMETHOD=AIC, MAXLAG=18)
'SHOW PCY_KING_ACTLIST_ADF

FREEZE(PCY_KING_ACTLIST_DFGLS) @PCY(KING_ACTLIST).UROOT(DFGLS,C,DIF=0,LAGMETHOD=AIC, MAXLAG=18)
'SHOW PCY_KING_ACTLIST_DFGLS

FREEZE(PCY_KING_ACTLIST_KPSS) @PCY(KING_ACTLIST).UROOT(KPSS,C,HAC=QS,BAND=5)
'SHOW PCY_KING_ACTLIST_KPSS


'--First Diff PCY Growth

'D_PCY_KING_ACTLIST.IDENT(24)


FREEZE(D_PCY_KING_ACTLIST_ADF) D(@PCY(KING_ACTLIST)).UROOT(ADF,C,LAGMETHOD=AIC, MAXLAG=18)
'SHOW D_PCY_KING_ACTLIST_ADF

FREEZE(D_PCY_KING_ACTLIST_DFGLS) D(@PCY(KING_ACTLIST)).UROOT(DFGLS,C,DIF=0,LAGMETHOD=AIC, MAXLAG=18)
'SHOW D_PCY_KING_ACTLIST_DFGLS

FREEZE(D_PCY_KING_ACTLIST_KPSS) D(@PCY(KING_ACTLIST)).UROOT(KPSS,C,HAC=QS,BAND=5)
'SHOW D_PCY_KING_ACTLIST_KPSS


'-------------------------------------------'
' 			STRUCTURAL MODELS
'-------------------------------------------'
SMPL 1997:08 2023:04
'----------------------
'	MEDIAN HOME PRICE
'-----------------------

EQUATION E_KING_PMED_1.LS(N)@pcy(king_pmed$) @pcy(king_actlist(-2)*king_atm(-2)) @pcy(jobs_nf) @pcy(nprime_share) mrtgrt$-mrtgrt$(-6)  @pcy(incpercap$(-8)) @pcy(permits(-18))  @pca(localequitywealth(-6)) POSTCOVID_2YR
E_KING_PMED_1.STATS


SERIES E_KING_PMED_1_RESIDS = RESID
'E_KING_PMED_1_RESIDS.IDENT(24)


'----------------------
'	NUMBER OF ACTIVE LISTINGS
'-----------------------

EQUATION E_KING_ACTLIST.LS(N) @pcy(log(king_actlist)) @pcy(nprime_share) mrtgrt$-mrtgrt$(-6)  @pcy(hstockq(-18)*king_pave$(-18)) covid postcovid_2yr
E_KING_ACTLIST.STATS


'SERIES E_KING_actlist_RESIDS = RESID
'E_KING_ACTLIST_RESIDS.IDENT(24)

'----------------------
'	INVENTORY DAYS
'-----------------------
'INVENTORYDAYS.LINE

GROUP PCY_INVENTORYDAYS_CHART
PCY_INVENTORYDAYS_CHART.ADD D(LOG(INVENTORYDAYS), 2, 12)
'PCY_INVENTORYDAYS_CHART.LINE



EQUATION E_KING_INVENTORYDAYS.LS(N) D(LOG(INVENTORYDAYS), 2, 12) @pcy(nprime_share) mrtgrt$-mrtgrt$(-6)  @PCY(HSTOCKQ(-12)*KING_PAVE$(-12)) covid POSTCOVID_2YR
'E_KING_INVENTORYDAYS.STATS

'SERIES E_KING_actlist_RESIDS = RESID
'E_KING_ACTLIST_RESIDS.IDENT(24)

'--DO I HAVE ALL THE VARIABLES I NEED FOR MODEL BUILDING 
SMPL 2021:10 2024:12 
'SHOW king_pmed$ king_actlist king_atm jobs_nf nprime_share mrtgrt$ incpercap$ permits localequitywealth hstockq king_pave$

'----------------------
'	BUILD THE MODEL
'-----------------------

'--BUILD MODEL
MODEL KING_RE$

	  KING_RE$.MERGE E_KING_PMED_1
	  KING_RE$.MERGE E_KING_ACTLIST
	  
	  KING_RE$.APPEND KING_PMED = KING_PMED$*(C_SEA_XCPIUAH/100)
	  KING_RE$.APPEND MRTGRT = MRTGRT$ + @PCY(XCPIU)

'--USE MODEL
'--HISTORICAL SOLVE
	KING_RE$.APPEND ASSIGN @ALL _SH
	SMPL 2021:11 2023:4
	KING_RE$.SOLVE
	'SHOW  king_pmed kinG_pmed_sh king_actlist king_actlist_sh  

'--FORECAST SOLVE
	KING_RE$.APPEND ASSIGN @ALL _SF
	SMPL 2023:5 2024:12
	KING_RE$.SOLVE
	SMPL 2021:11 2024:12
	SHOW king_pmed kinG_pmed_sF king_actlist king_actlist_sF 
	
SAVE CAP_MONTHLY

'--7/2 tO DO FOR NEXT TIME: FINISH UP SUPPORTING ARIMAS; DO VAR STUFF
'--BIG QUESTION: DOP RISING INTEREST RATES MEAN MORE TIME ON MARKET MEANS MORE INVENTORY... ACCORING TO THEORY